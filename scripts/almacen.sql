DROP DATABASE IF EXISTS ALMACEN;
CREATE DATABASE ALMACEN;
USE ALMACEN;




CREATE TABLE FABRICANTES(
COD_FABRICANTE SMALLINT NOT NULL,
NOMBRE         VARCHAR(15), 
PAIS           VARCHAR(15));

ALTER TABLE FABRICANTES ADD CONSTRAINT pk_fab PRIMARY KEY (COD_FABRICANTE);

INSERT INTO FABRICANTES VALUES(10,'CALVO', 'ESPAÑA');
INSERT INTO FABRICANTES VALUES(15,'LU', 'BELGICA');
INSERT INTO FABRICANTES VALUES(20,'BARILLA', 'ITALIA');
INSERT INTO FABRICANTES VALUES(25,'GALLO', 'ESPAÑA');
INSERT INTO FABRICANTES VALUES(30,'PRESIDENT', 'FRANCIA');


CREATE TABLE TIENDAS(
NIF       VARCHAR(10) NOT NULL,
NOMBRE    VARCHAR(20),
DIRECCION VARCHAR(20),
POBLACION VARCHAR(20),
PROVINCIA VARCHAR(20),
CODPOSTAL MEDIUMINT(5) );

ALTER TABLE TIENDAS ADD CONSTRAINT pk_tien PRIMARY KEY (NIF);

INSERT INTO TIENDAS VALUES('1111-A','Almacenes Pérez', 'C-Toledo, 20',
 'Siguenza','GUADALAJARA',19104); 
INSERT INTO TIENDAS VALUES('5555-B','La gacela', 'C-Santander Rios, 45',
 'Azuqueca','GUADALAJARA', 19209);
INSERT INTO TIENDAS VALUES('2222-A','Comestibles Rodolfo', 
'C- del Val s-n', 'Alcalá de Henares','MADRID',28804);
INSERT INTO TIENDAS VALUES('4444-A','La Pasta Gansa', 'C-Alcalá, 2',
 'Ajalvir','MADRID', 28765);
REPLACE INTO TIENDAS VALUES('3333-A','Ultramarinos Montse',
  'Avda. Pio 10', 'Toledo','TOLEDO',45100);
INSERT INTO TIENDAS VALUES('4141-B','Todo Toledo',
 'C-Avila 24', 'Talavera','TOLEDO',45199);


CREATE TABLE ARTICULOS(
ARTICULO       VARCHAR(20) NOT NULL,
COD_FABRICANTE SMALLINT NOT NULL,
PESO           SMALLINT NOT NULL ,
CATEGORIA      VARCHAR(10) NOT NULL,
PRECIO_VENTA   DECIMAL (6,2),
PRECIO_COSTO   DECIMAL (6,2),
EXISTENCIAS    MEDIUMINT ) ;

ALTER TABLE ARTICULOS ADD constraint pk_artic PRIMARY KEY (ARTICULO, COD_FABRICANTE, PESO, CATEGORIA);
ALTER TABLE ARTICULOS ADD constraint fk_art_fab FOREIGN KEY (cod_fabricante) REFERENCES FABRICANTES (COD_FABRICANTE); 

INSERT INTO ARTICULOS VALUES ('Macarrones',20, 1, 'Primera',1, 0.98,120);

INSERT INTO ARTICULOS VALUES ('Tallarines',20, 2, 'Primera',1.20,1,100);

INSERT INTO ARTICULOS VALUES ('Tallarines',20, 1, 'Segunda',0.99,0.50,100);

INSERT INTO ARTICULOS VALUES ('Macarrones',20, 1, 'Tercera',0.80,0.50,100);

INSERT INTO ARTICULOS VALUES ('Atún',10, 3, 'Primera',2,1.50,220);
INSERT INTO ARTICULOS VALUES ('Atún',10, 3, 'Segunda',1.50,1,220);
INSERT INTO ARTICULOS VALUES ('Atún',10, 3, 'Tercera',1,0.50,220);
INSERT INTO ARTICULOS VALUES ('Sardinillas',10, 1, 'Primera',2.5,2,200);
INSERT INTO ARTICULOS VALUES ('Sardinillas',10, 1, 'Segunda',2,1.6,200);
INSERT INTO ARTICULOS VALUES ('Sardinillas',10, 1, 'Tercera',1,1.5,220);
INSERT INTO ARTICULOS VALUES ('Mejillones',10, 1, 'Tercera',1,0.9,200);
INSERT INTO ARTICULOS VALUES ('Mejillones',10, 1, 'Primera',3,2,300);



INSERT INTO ARTICULOS VALUES ('Macarrones',25, 1, 'Primera',1.5,1,150);
INSERT INTO ARTICULOS VALUES ('Tallarines',25, 1, 'Primera',1,0.90,100);
INSERT INTO ARTICULOS VALUES ('Fideos',25, 1, 'Segunda',0.75,0.50,100);
INSERT INTO ARTICULOS VALUES ('Fideos',25, 1, 'Primera',1,0.80,100);


INSERT INTO ARTICULOS VALUES ('Galletas Cuadradas',15, 1, 'Primera',2,1.8,100);
INSERT INTO ARTICULOS VALUES ('Galletas Cuadradas',15, 1, 'Segunda',1,0.8,100);
INSERT INTO ARTICULOS VALUES ('Galletas Cuadradas',15, 1, 'Tercera',0.50,0.40,100);
INSERT INTO ARTICULOS VALUES ('Barquillos',15, 1, 'Primera',1,0.80,100);
INSERT INTO ARTICULOS VALUES ('Barquillos',15, 1, 'Segunda',1,0.80,100);
INSERT INTO ARTICULOS VALUES ('Canutillos',15, 2, 'Primera',1.7,1.5,110);
INSERT INTO ARTICULOS VALUES ('Canutillos',15, 2, 'Segunda',1.2,1.5,110);

INSERT INTO ARTICULOS VALUES ('Leche entera',30, 1, 'Primera',1.1,1,300);
INSERT INTO ARTICULOS VALUES ('Leche desnat.',30, 1,'Primera',1.2,1,300);
INSERT INTO ARTICULOS VALUES ('Leche semi.',30, 1, 'Primera',1.30,1.10,300);
INSERT INTO ARTICULOS VALUES ('Leche entera',30, 2,'Primera',2.10,2,300);
INSERT INTO ARTICULOS VALUES ('Leche desnat.',30, 2, 'Primera',2.2,2,300);
INSERT INTO ARTICULOS VALUES ('Leche semi.',30, 2,  'Primera',2.3,2.1,300);
INSERT INTO ARTICULOS VALUES ('Mantequilla',30, 1, 'Primera',1.8,2,200);
INSERT INTO ARTICULOS VALUES ('Mantequilla',30, 1, 'Segunda',1.4,2,200);

CREATE TABLE PEDIDOS(
NIF               VARCHAR(10) NOT NULL,
ARTICULO          VARCHAR(20) NOT NULL,
COD_FABRICANTE    SMALLINT NOT NULL,
PESO              SMALLINT NOT NULL,
CATEGORIA         VARCHAR(10) NOT NULL,
FECHA_PEDIDO      DATE NOT NULL,
UNIDADES_PEDIDAS  SMALLINT
) ;

ALTER TABLE PEDIDOS ADD CONSTRAINT pk_ped PRIMARY KEY (NIF, ARTICULO,COD_FABRICANTE, PESO, CATEGORIA, FECHA_PEDIDO);
ALTER TABLE PEDIDOS ADD constraint fk_ped_fab FOREIGN KEY (cod_fabricante) REFERENCES FABRICANTES (COD_FABRICANTE); 
ALTER TABLE PEDIDOS ADD constraint fk_ped_tiend FOREIGN KEY (NIF) REFERENCES TIENDAS (NIF); 
ALTER TABLE PEDIDOS ADD constraint fk_ped_art FOREIGN KEY (ARTICULO, COD_FABRICANTE, PESO, CATEGORIA) REFERENCES ARTICULOS (ARTICULO, COD_FABRICANTE, PESO, CATEGORIA) ON DELETE CASCADE;

INSERT INTO PEDIDOS VALUES ('5555-B','Macarrones',20, 1, 'Primera',
'2022-02-18', 30);
INSERT INTO PEDIDOS VALUES ('5555-B','Atún',10, 3, 'Primera',
'2022-02-21', 10);
INSERT INTO PEDIDOS VALUES ('5555-B','Atún',10, 3, 'Segunda',
'2022-03-11', 4);
INSERT INTO PEDIDOS VALUES ('5555-B','Sardinillas',10, 1, 'Segunda', 
'2022-03-11', 10);
INSERT INTO PEDIDOS VALUES ('5555-B','Macarrones',25, 1, 'Primera',
'2022-04-14', 12);
INSERT INTO PEDIDOS VALUES ('5555-B','Fideos',25, 1, 'Segunda', 
'2022-05-18', 24);
INSERT INTO PEDIDOS VALUES ('5555-B','Fideos',25, 1, 'Segunda', 
'2022-05-19', 20);
INSERT INTO PEDIDOS VALUES ('5555-B','Galletas Cuadradas',
15, 1, 'Segunda', '2022-06-20', 15);

INSERT INTO PEDIDOS VALUES ('1111-A','Barquillos',15, 1, 'Primera',
'2022-02-20', 10);

INSERT INTO PEDIDOS VALUES ('1111-A','Canutillos',15, 2, 'Segunda',
'2022-04-10', 12);
INSERT INTO PEDIDOS VALUES ('1111-A','Leche semi.',30, 1, 'Primera',
'2022-06-24', 5);
INSERT INTO PEDIDOS VALUES ('1111-A','Leche semi.',30, 2, 'Primera',
'2022-07-04', 11);
INSERT INTO PEDIDOS VALUES ('1111-A','Mantequilla',30, 1, 'Primera', 
'2022-10-07', 10);

INSERT INTO PEDIDOS VALUES ('4141-B','Macarrones',20, 1, 'Primera',
'2022-04-04', 30);
INSERT INTO PEDIDOS VALUES ('4141-B','Atún',10, 3, 'Primera',
'2022-11-06', 10);
INSERT INTO PEDIDOS VALUES ('4141-B','Atún',10, 3, 'Segunda',
'2022-12-08', 9);


INSERT INTO PEDIDOS VALUES ('2222-A','Sardinillas',10, 1,
 'Segunda', '2022-12-08',20);
INSERT INTO PEDIDOS VALUES ('2222-A','Sardinillas',10, 1, 
'Tercera', '2022-12-08',22);
INSERT INTO PEDIDOS VALUES('2222-A','Mejillones',10,1,
 'Primera', '2022-12-09',1000);

INSERT INTO PEDIDOS VALUES ('3333-A','Macarrones',25, 1,
 'Primera','2022-10-11',8);
INSERT INTO PEDIDOS VALUES ('3333-A','Tallarines',25, 1, 
'Primera', '2022-12-11',9);
 INSERT INTO PEDIDOS VALUES ('3333-A','Fideos',25, 1, 
'Primera', '2022-10-11',11);
 INSERT INTO PEDIDOS VALUES ('3333-A','Galletas Cuadradas',
15, 1, 'Primera', '2022-10-11',6);
INSERT INTO PEDIDOS VALUES ('3333-A','Barquillos',15, 1, 
'Segunda', '2022-10-11',40);
 INSERT INTO PEDIDOS VALUES ('3333-A','Canutillos',15, 2, 
'Segunda', '2022-10-11',10);


CREATE TABLE VENTAS (
NIF                VARCHAR(10) NOT NULL,
ARTICULO           VARCHAR(20) NOT NULL,
COD_FABRICANTE     SMALLINT NOT NULL,
PESO               SMALLINT NOT NULL,
CATEGORIA          VARCHAR(10) NOT NULL,
FECHA_VENTA        DATE NOT NULL,
UNIDADES_VENDIDAS  SMALLINT
);

ALTER TABLE VENTAS ADD CONSTRAINT pk_vent PRIMARY KEY (NIF, ARTICULO, COD_FABRICANTE, PESO, CATEGORIA, FECHA_VENTA);
ALTER TABLE VENTAS ADD constraint fk_vent_fab FOREIGN KEY (cod_fabricante) REFERENCES FABRICANTES (COD_FABRICANTE); 
ALTER TABLE VENTAS ADD constraint fk_vent_tiend FOREIGN KEY (NIF) REFERENCES TIENDAS (NIF); 
ALTER TABLE VENTAS ADD constraint fk_vent_art FOREIGN KEY (ARTICULO, COD_FABRICANTE, PESO, CATEGORIA) REFERENCES ARTICULOS (ARTICULO, COD_FABRICANTE, PESO, CATEGORIA) ON DELETE CASCADE;
  
 
 
INSERT INTO VENTAS VALUES ('5555-B','Macarrones',20, 1, 'Primera',
'2022-09-02', 5);
INSERT INTO VENTAS VALUES ('5555-B','Atún',10, 3, 'Primera',
'2022-09-02', 6);
INSERT INTO VENTAS VALUES ('5555-B','Atún',10, 3, 'Segunda',
'2022-10-03', 15);
INSERT INTO VENTAS VALUES ('5555-B','Sardinillas',10, 1, 'Segunda', 
'2022-10-03', 8);
INSERT INTO VENTAS VALUES ('5555-B','Macarrones',25, 1, 'Primera',
'2022-07-04', 2);
INSERT INTO VENTAS VALUES ('5555-B','Fideos',25, 1, 'Segunda', 
'2022-05-18', 14);
INSERT INTO VENTAS VALUES ('5555-B','Leche semi.',30, 1, 'Primera',
'2022-06-24', 5);

INSERT INTO VENTAS VALUES ('2222-A','Galletas Cuadradas',
15, 1, 'Segunda', '2022-06-20', 5);
INSERT INTO VENTAS VALUES ('2222-A','Barquillos',15, 1, 'Primera',
'2022-02-20', 6);
INSERT INTO VENTAS VALUES ('2222-A','Canutillos',15, 2, 'Segunda',
'2022-10-06', 2);
INSERT INTO VENTAS VALUES ('2222-A','Sardinillas',10, 1,
 'Segunda', '2022-05-08',5);
INSERT INTO VENTAS VALUES ('2222-A','Sardinillas',10, 1, 
'Tercera', '2022-05-08',5);


INSERT INTO VENTAS VALUES ('3333-A','Leche semi.',30, 2, 'Primera',
'2022-06-07', 11);
INSERT INTO VENTAS VALUES ('3333-A','Mantequilla',30, 1, 'Primera', 
'2022-06-07', 10);
INSERT INTO VENTAS VALUES ('3333-A','Macarrones',20, 1, 'Primera',
'2022-06-04', 30);
INSERT INTO VENTAS VALUES ('3333-A','Atún',10, 3, 'Primera',
'2022-06-04', 10);
INSERT INTO VENTAS VALUES ('3333-A','Barquillos',15, 1, 
'Segunda', '2022-05-11',4);
 INSERT INTO VENTAS VALUES ('3333-A','Canutillos',15, 2, 
'Segunda', '2022-05-11',4);

INSERT INTO VENTAS VALUES ('4141-B','Atún',10, 3, 'Segunda',
'2022-12-08', 2);

INSERT INTO VENTAS VALUES ('4141-B','Macarrones',25, 1,
 'Primera','2022-10-11',2);
INSERT INTO VENTAS VALUES ('4141-B','Tallarines',25, 1, 
'Primera', '2022-11-11',3);
INSERT INTO VENTAS VALUES ('4141-B','Canutillos',15, 2, 
'Segunda', '2022-11-11',8);
